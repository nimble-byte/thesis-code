(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[156],{755:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});var i=n(5155),s=n(2115),r=n(5695),o=n(5144),l=n(2258);function a(e){let{children:t,style:n}=e;return(0,i.jsx)("div",{style:{display:"flex",justifyContent:"space-between",...n},children:t})}var d=n(3986);function u(e){let{currentStep:t,totalSteps:n,className:s}=e;return(0,i.jsx)("div",{className:s,style:{width:"100%",maxWidth:480,margin:"16px auto 16px auto"},children:(0,i.jsx)("div",{style:{width:"100%",height:8,backgroundColor:"#f0f0f0",borderRadius:4,overflow:"hidden"},children:(0,i.jsx)("div",{style:{width:"".concat(t/n*100,"%"),height:"100%",backgroundColor:"#0070f3",transition:"width 0.3s ease",borderRadius:4}})})})}function c(e){let{header:t,body:n,footer:r,open:o,onClose:l}=e;return((0,s.useEffect)(()=>{if(o)return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e);function e(e){"Escape"===e.key&&l()}},[o,l]),o)?(0,i.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"rgba(0,0,0,0.2)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},onClick:l,children:(0,i.jsxs)("div",{style:{background:"#fff",borderRadius:16,minWidth:320,maxWidth:480,width:"100%",boxShadow:"0 2px 24px rgba(0,0,0,0.12)",padding:0,display:"flex",flexDirection:"column"},onClick:e=>e.stopPropagation(),children:[t&&(0,i.jsx)("div",{style:{padding:"16px 24px 0 24px",fontWeight:600,fontSize:"1.2rem"},children:t}),n&&(0,i.jsx)("div",{style:{padding:"16px 24px"},children:n}),r&&(0,i.jsx)("div",{style:{padding:"16px 24px",display:"flex",justifyContent:"flex-end",gap:16},children:r})]})}):null}function h(e){let{open:t,onClose:n,onReplace:r,currentTask:o}=e,[a,u]=(0,s.useState)([]),[h,p]=(0,s.useState)(!0),[x,f]=(0,s.useState)(null),[g,m]=(0,s.useState)(null);return(0,s.useEffect)(()=>{t&&(p(!0),f(null),m(null),fetch("/api/tasks?difficulty=".concat(o.difficulty,"&exclude=").concat(o.pid)).then(e=>e.json()).then(e=>{u(Array.isArray(e)?e:[]),p(!1)}).catch(()=>{f("Failed to load replacement tasks."),p(!1)}))},[t,o]),(0,i.jsx)(c,{open:t,onClose:n,header:(0,i.jsx)("h1",{children:"Replace Task"}),body:h?(0,i.jsx)("div",{children:"Loading tasks..."}):x?(0,i.jsx)("div",{children:x}):0===a.length?(0,i.jsx)("div",{children:"No other tasks available for this difficulty."}):(0,i.jsx)("ul",{style:{maxHeight:240,overflowY:"auto",padding:"0 16px 0 0",margin:0},children:a.map(e=>(0,i.jsxs)("li",{style:{listStyle:"none",marginBottom:8,padding:8,border:(null==g?void 0:g.pid)===e.pid?"2px solid #0070f3":"2px solid #eee",borderRadius:8,cursor:"pointer",background:(null==g?void 0:g.pid)===e.pid?"#f0f8ff":"#fffff"},onClick:()=>m(e),children:[(0,i.jsxs)("div",{style:{fontWeight:600},children:["ID: ",e.pid]}),(0,i.jsx)("div",{style:{fontSize:"0.9rem",color:"#66666"},children:e.question})]},e.pid))}),footer:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.A,{onClick:n,children:"Cancel"}),(0,i.jsx)(l.A,{onClick:()=>{g&&r(g)},disabled:!g,children:"Replace"})]})})}var p=function(e){return e.LOADING="loading",e.ERROR="error",e.IN_PROGRESS="inProgress",e.SUBMITTING="submitting",e}(p||{});function x(e){let t=(0,r.useRouter)(),{setId:n}=s.use(e.params),[c,p]=(0,s.useState)(0),[x,f]=(0,s.useState)(new Date),[g,m]=(0,s.useState)(null),[b,j]=(0,s.useState)([]),[y,v]=(0,s.useState)(!1),[S,w]=(0,s.useState)([]),[k,A]=(0,s.useState)("loading"),[C,R]=(0,s.useState)(null);(0,s.useEffect)(()=>{n&&(A("loading"),fetch("/api/sets/".concat(n)).then(e=>e.json()).then(e=>{Array.isArray(e)?(j(e),f(new Date),A("inProgress")):(A("error"),R(e.error||"Failed to load task set"))}).catch(e=>{A("error"),R("Failed to load task set")}))},[n]);let O=async()=>{if("submitting"===k||!g)return;let e=b[c],i=[...S,{pid:e.pid,givenAnswer:g,correctAnswer:e.answer,question:e.question,startedAt:null==x?void 0:x.toISOString(),completedAt:new Date().toISOString()}];A("submitting"),R(null);let s={setId:n,answers:i,uuid:crypto.randomUUID(),completedAt:new Date().toISOString()};console.log("Task Set Solution:",s);try{let e=await fetch("/api/solutions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!e.ok)throw Error((await e.json()).error||"Failed to save solution");w([]),t.push("/sets/completed?uuid=".concat(s.uuid))}catch(e){R(e.message||"Failed to save solution"),A("inProgress")}};if("loading"===k)return(0,i.jsx)("div",{children:"Loading task set..."});if("error"===k)return(0,i.jsx)("div",{children:C});if(0===b.length)return(0,i.jsx)("div",{children:"No tasks found in this set."});let I=b[c],D=c===b.length-1;return(0,i.jsxs)("div",{style:{position:"relative",display:"flex",flexDirection:"column",width:"100%",maxWidth:480,margin:"0 auto"},children:[(0,i.jsx)(u,{currentStep:c+1,totalSteps:b.length}),(0,i.jsx)(o.A,{task:I,onAnswerChange:m,selected:g}),D&&C&&(0,i.jsx)("div",{style:{margin:"16px 0 0 0",padding:"16px 24px",backgroundColor:"#dc3545",color:"white",borderRadius:8,fontSize:"1rem",fontWeight:"bold",alignSelf:"flex-end",maxWidth:400},children:C}),(0,i.jsxs)(a,{children:[(0,i.jsx)(d.A,{onClick:()=>{v(!0)},children:"Replace Task"}),!D&&(0,i.jsx)(l.A,{onClick:()=>{if(!g)return;let e=b[c],t={pid:e.pid,givenAnswer:g,correctAnswer:e.answer,question:e.question,startedAt:null==x?void 0:x.toISOString(),completedAt:new Date().toISOString()};console.log("Current Task Answer:",t),w(e=>[...e,t]),m(null),c<b.length-1&&(p(c+1),f(new Date))},disabled:!g||"submitting"===k,children:"Next Task â†’"}),D&&(0,i.jsx)(l.A,{onClick:O,disabled:!g||"submitting"===k,children:"submitting"===k?"Saving...":"Submit Solution"})]}),(0,i.jsx)(h,{open:y,onClose:()=>{v(!1)},onReplace:e=>{j(t=>t.map((t,n)=>n===c?e:t)),f(new Date),m(null),v(!1)},currentTask:I})]})}},1370:(e,t,n)=>{Promise.resolve().then(n.bind(n,755))},2258:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(5155),s=n(2115);let r=e=>{let{children:t,disabled:n,style:r,...o}=e,[l,a]=s.useState(!1),d="#0070f3";n?d="#b3c6e6":l&&(d="#0051cc");let u={padding:"8px 16px",backgroundColor:d,color:"white",border:"none",borderRadius:8,fontSize:"1rem",fontWeight:"bold",cursor:n?"not-allowed":"pointer",boxShadow:"0 4px 16px rgba(0, 112, 243, 0.3)",transition:"all 0.2s ease",...r};return(0,i.jsx)("button",{...o,disabled:n,style:{...u,transform:l&&!n?"translateY(-2px)":"translateY(0)"},onMouseOver:()=>!n&&a(!0),onMouseOut:()=>a(!1),children:t})}},3986:(e,t,n)=>{"use strict";n.d(t,{A:()=>r});var i=n(5155),s=n(2115);let r=e=>{let{children:t,disabled:n,style:r,...o}=e,[l,a]=s.useState(!1),d="#eeeeee";n?d="#e0e0e0":l&&(d="#e0e0e0");let u={padding:"8px 16px",backgroundColor:d,color:"#222222",border:"none",borderRadius:8,fontSize:"1rem",fontWeight:"bold",cursor:n?"not-allowed":"pointer",boxShadow:"none",transition:"all 0.2s ease",...r};return(0,i.jsx)("button",{...o,disabled:n,style:u,onMouseOver:()=>!n&&a(!0),onMouseOut:()=>a(!1),children:t})}},5144:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n(5155);function s(e){let{task:t,onAnswerChange:n,selected:s}=e,r="/images/".concat(t.image);return(0,i.jsxs)("div",{style:{margin:"24px auto",padding:16,border:"1px solid #eeeeee",borderRadius:8,width:"100%"},children:[(0,i.jsxs)("h1",{style:{marginBottom:16,textAlign:"center",fontSize:"1.5rem"},children:["Task: ",t.pid]}),(0,i.jsx)("img",{src:r,alt:"Task",style:{objectFit:"contain",margin:"0 auto 16px auto",display:"block"}}),(0,i.jsx)("h2",{style:{marginBottom:16},children:t.translation}),(0,i.jsx)("form",{children:t.choices.map((e,t)=>(0,i.jsx)("div",{style:{marginBottom:8},children:(0,i.jsxs)("label",{children:[(0,i.jsx)("input",{type:"radio",name:"answer",value:e,checked:s===e,onChange:()=>{null==n||n(e)},style:{marginRight:8}}),e]})},t))})]})}n(2115)},5695:(e,t,n)=>{"use strict";var i=n(8999);n.o(i,"useRouter")&&n.d(t,{useRouter:function(){return i.useRouter}}),n.o(i,"useSearchParams")&&n.d(t,{useSearchParams:function(){return i.useSearchParams}})}},e=>{e.O(0,[441,964,358],()=>e(e.s=1370)),_N_E=e.O()}]);